# Doris 中文文档

> Apache Doris 是一个基于 MPP 架构的分析型数据库，支持高并发的实时 OLAP 查询。

## 文档列表

| 文档 | 说明 | 关键内容 |
|------|------|---------|
| [01-architecture.md](01-architecture.md) | 架构详解 | FE/BE 架构、Tablet 存储、查询流程 |
| [02-data-model.md](02-data-model.md) | 数据模型详解 | Unique/Aggregate/Duplicate、分区、分桶 |
| [03-data-operations.md](03-data-operations.md) | 数据操作指南 | INSERT/UPDATE/DELETE、导入导出 |
| [04-sql-reference.md](04-sql-reference.md) | SQL 参考 | DDL/DML/DQL、函数、数据类型 |
| [05-operations.md](05-operations.md) | 运维指南 | 部署、监控、高可用、故障处理 |

## 快速入门

### 核心概念

```
┌─────────────────────────────────────────────────────────────────┐
│                     Doris 核心概念                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      FE (Frontend)                       │   │
│  │  - SQL 解析和优化                                         │   │
│  │  - 元数据管理                                             │   │
│  │  - 查询调度                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      BE (Backend)                        │   │
│  │  - 数据存储                                               │   │
│  │  - 查询执行                                               │   │
│  │  - 数据导入                                               │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      数据模型                            │   │
│  │  - Tablet: 数据分片                                       │   │
│  │  - Partition: 逻辑分区                                    │   │
│  │  - Rollup: 物化索引                                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 代码示例

```sql
-- 1. 创建表
CREATE TABLE users (
    user_id     BIGINT      NOT NULL,
    username    VARCHAR(50) NOT NULL,
    email       VARCHAR(100),
    age         INT,
    create_time DATETIME    DEFAULT CURRENT_TIMESTAMP
) UNIQUE KEY(user_id)
DISTRIBUTED BY HASH(user_id) BUCKETS 4
PROPERTIES ("replication_num" = "3");

-- 2. 插入数据
INSERT INTO users (user_id, username, email, age)
VALUES (1001, 'Alice', 'alice@example.com', 25);

-- 3. 查询数据
SELECT * FROM users WHERE age >= 18;

-- 4. 更新数据
UPDATE users SET age = 26 WHERE user_id = 1001;

-- 5. 删除数据
DELETE FROM users WHERE user_id = 1001;
```

## 文档导航

### 入门

1. 先阅读 [01-architecture.md](01-architecture.md) 了解 Doris 核心架构
2. 学习 [02-data-model.md](02-data-model.md) 掌握数据模型设计

### 数据操作

3. 掌握 [03-data-operations.md](03-data-operations.md) 数据导入导出
4. 参考 [04-sql-reference.md](04-sql-reference.md) SQL 语法速查

### 运维管理

5. 学习 [05-operations.md](05-operations.md) 集群运维

## 数据模型选择

```
┌─────────────────────────────────────────────────────────────────┐
│                    数据模型选择指南                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Unique 模型                                            │   │
│  │  ✓ 需要唯一性约束                                        │   │
│  │  ✓ 需要实时更新                                          │   │
│  │  ✓ 主键索引查询                                          │   │
│  │  场景: 用户信息、订单数据                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Aggregate 模型                                         │   │
│  │  ✓ 需要预聚合统计                                        │   │
│  │  ✓ 减少存储空间                                          │   │
│  │  ✓ 实时分析场景                                          │   │
│  │  场景: 指标统计、报表数据                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Duplicate 模型                                         │   │
│  │  ✓ 需要保留所有明细                                      │   │
│  │  ✓ 日志/事件数据                                         │   │
│  │  ✓ 灵活查询                                              │   │
│  │  场景: 日志分析、行为追踪                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 版本兼容性

| Doris 版本 | MySQL 协议 | Spark | Flink |
|-----------|-----------|-------|-------|
| 2.0.x | 5.1+ | 3.1+ | 1.14+ |
| 1.2.x | 5.1+ | 3.0+ | 1.11+ |

## 生态集成

```
┌─────────────────────────────────────────────────────────────────┐
│                       Doris 生态集成                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────┬──────────────────┬──────────────────┐   │
│  │     数据导入      │     数据查询      │     数据导出      │   │
│  ├──────────────────┼──────────────────┼──────────────────┤   │
│  │  - Stream Load   │  - MySQL 协议    │  - Export       │   │
│  │  - Broker Load   │  - JDBC          │  - SELECT INTO  │   │
│  │  - Routine Load  │  - HTTP API      │  - Spark SQL    │   │
│  │  - Spark Load    │  - Python        │  - Flink Sink   │   │
│  └──────────────────┴──────────────────┴──────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    外部系统                               │   │
│  │  - Spark / Flink / Kafka / Hive                         │   │
│  │  - HDFS / S3 / OSS / MinIO                              │   │
│  │  - Elasticsearch / ClickHouse                            │   │
│  │  - Grafana / Prometheus / K8s                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 最佳实践

### 建表优化

```sql
-- 1. 选择合适的分桶数
-- 建议: 集群 BE 节点数 * 核心数
-- 范围: 10-1000

-- 2. 选择合适的分桶键
-- 高基数字段
-- Join 字段

-- 3. 分区设计
-- 按时间分区 (日志数据)
-- 按业务分区 (业务数据)

-- 4. 索引设计
-- Bloom Filter 索引 (高基数字段)
-- Bitmap 索引 (低基数离散字段)

-- 5. 物化视图
-- 预计算聚合
-- 加速查询
```

### 查询优化

```sql
-- 1. 利用分区裁剪
SELECT * FROM orders
WHERE order_date = '2024-01-15';

-- 2. 利用分桶裁剪
SELECT * FROM orders o
JOIN users u ON o.user_id = u.user_id
WHERE u.user_id = 1001;

-- 3. 使用物化视图
-- Doris 自动选择最优物化视图

-- 4. 避免 Select *
SELECT user_id, name FROM users;

-- 5. 合理使用 JOIN
-- 小表 Broadcast Join
-- 大表 Shuffle Join
-- Colocate Join (分桶一致)
```

### 导入优化

```sql
-- 1. 批量导入
-- 单次导入 1GB 以内
-- 合理设置超时时间

-- 2. 并行导入
-- 合理设置并发数

-- 3. 避免小文件
-- 合并小文件后再导入

-- 4. Routine Load
-- 合理设置消费位点
-- 监控消费延迟
```

## 常见问题

| 问题 | 解决方案 |
|------|---------|
| 查询慢 | 增加并行度、优化 SQL、使用物化视图 |
| 导入慢 | 批量导入、增大并发、检查磁盘 IO |
| 内存不足 | 增加 BE 内存、优化查询 |
| 副本缺失 | 检查 BE 状态、手动修复副本 |
| 磁盘满 | 清理历史数据、扩容磁盘 |
| FE 故障 | 配置高可用、自动选举 |
| BE 故障 | 配置多副本、自动恢复 |

## 相关资源

- [官方文档](https://doris.apache.org/learn_docs/get-started/)
- [GitHub 仓库](https://github.com/apache/doris)
- [社区论坛](https://ask.doris.apache.org/)
