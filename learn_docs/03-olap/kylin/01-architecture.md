# Apache Kylin 架构详解

## 目录

- [概述](#概述)
- [核心概念](#核心概念)
- [架构原理](#架构原理)
- [Cube 模型](#cube-模型)
- [构建流程](#构建流程)

---

## 概述

Apache Kylin 是一个开源的分布式分析引擎，提供 SQL 接口和多维分析能力。

### 核心特性

| 特性 | 说明 |
|------|------|
| **超快 OLAP** | 预计算，秒级响应 |
| **标准 SQL** | 支持 SQL 92/99 |
| **多数据源** | Hive, Kafka, RDBMS |
| **高并发** | 多维分析 |
| **可扩展** | 水平扩展 |

---

## 核心概念

### 核心术语

```
┌─────────────────────────────────────────────────────────────────┐
│                    Kylin 核心概念                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Project     │  项目空间                                      │
│  Data Model  │  数据模型                                      │
│  Cube        │  多维立方体                                    │
│  Dimension   │  维度                                          │
│  Measure     │  度量                                          │
│  Lookup Table│  查找表                                        │
│  Aggregation │  聚合                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 架构原理

### 架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                    Kylin 架构                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    REST API / Web UI                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           │                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Query Engine                          │   │
│  │  - SQL 解析                                              │   │
│  │  - 计划生成                                              │   │
│  │  - 结果返回                                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           │                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Metadata Manager                      │   │
│  │  - 项目管理                                              │   │
│  │  - 模型管理                                              │   │
│  │  - Cube 管理                                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           │                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Cube Engine                           │   │
│  │  ┌───────────────────────────────────────────────────┐  │   │
│  │  │  Building  │  Merging  │  Purging  │  Segment   │  │   │
│  │  └───────────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                           │                                    │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Storage (HBase/HDFS)                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Cube 模型

### 维度类型

| 类型 | 说明 |
|------|------|
| Normal | 普通维度 |
| Derived | 衍生维度 (来自查找表) |
| Hierarchy | 层级维度 |
| Joint | 联合维度 |

### 聚合组

```sql
-- 聚合组设计
-- 聚合组1: 用户分析
SELECT device, browser, country

-- 聚合组2: 地域分析
SELECT country, province, city

-- 聚合组3: 时间分析
SELECT year, month, day
```

---

## 相关文档

| 文档 | 说明 |
|------|------|
| [02-data-model.md](02-data-model.md) | 数据模型 |
| [03-cube-build.md](03-cube-build.md) | Cube 构建 |
| [04-query-guide.md](04-query-guide.md) | 查询指南 |
| [README.md](README.md) | 索引文档 |
